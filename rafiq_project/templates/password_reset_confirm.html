{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password — RAFIQ</title>
  <link rel="stylesheet" href="{% static 'css/auth.css' %}">
</head>
<body>
  <div class="card">
    <h1>🔐 Reset Your Password</h1>
    <p class="small">Enter your new password below.</p>

    <div class="row">
      <label for="password">New Password</label>
      <input type="password" id="password" placeholder="Enter new password" />
      <div id="password-error" class="msg"></div>
    </div>

    <button class="btn" onclick="resetPassword()">Reset Password</button>

    <p id="response" class="msg" style="text-align:center;"></p>
  </div>

  <script>
    async function resetPassword() {
        const responseEl = document.getElementById("response");
        const new_password = document.getElementById("password").value;

        // ✅ قراءة uidb64 و token من اللينك
        const pathParts = window.location.pathname.split("/"); 
        // مثال: /accounts/reset-password/NjM/cy0q1t-f7f3fb011658f974e7c4c410125a614d/
        const uidb64 = pathParts[3];
        const token = pathParts[4];

        console.log("🚀 Sending reset:", { uidb64, token, new_password });

        try {
            const response = await fetch(`/api/accounts/password-reset-confirm/${uidb64}/${token}/`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ new_password })
            });

            if (response.ok) {
                responseEl.textContent = "✅ Password has been reset successfully!";
                responseEl.style.color = "green";
            } else {
                const error = await response.json();
                responseEl.textContent = "❌ " + (error.detail || error.new_password || "Failed to reset password.");
                responseEl.style.color = "red";
            }
        } catch (err) {
            console.error("⚠️ Error:", err);
            responseEl.textContent = "❌ Network error occurred.";
            responseEl.style.color = "red";
        }
    }
  </script>
</body>
</html>
